# 🚀 Apps Script 배포 체크리스트

## ✅ 배포 전 필수 확인 사항

### 1. 기능 테스트
- [x] `getSharedTemplates()` 함수 정상 작동 확인
- [x] 메타데이터(properties) 추출 정상 작동 확인
- [x] API 응답 구조 확인 (`description`, `tag`, `creatorEmail`, `createdDate`, `modifiedDate` 포함)
- [ ] 실제 프론트엔드에서 템플릿 목록 로드 테스트
- [ ] 템플릿 업로드/수정/삭제 기능 테스트

### 2. 에러 처리 확인
- [x] API 재시도 로직 (지수적 백오프) 구현됨
- [x] properties가 없는 경우 빈 배열로 처리
- [x] 파일 조회 실패 시 에러 핸들링
- [x] API 사용량 제한(429) 에러 처리

### 3. 성능 최적화
- [x] API 호출 최적화 (10개마다 sleep)
- [x] `maxResults: 1000` 설정으로 결과 제한
- [ ] 대량 파일 처리 시 성능 테스트

### 4. 코드 정리 (선택사항)
- [ ] 불필요한 디버깅 로그 제거 또는 조건부 처리
- [x] 핵심 에러 로그는 유지 (`console.error`, `console.warn`)

### 5. 권한 및 설정 확인
- [ ] Drive API 활성화 확인
- [ ] 스크립트 속성 설정 확인:
  - `ROOT_FOLDER_NAME`: "hot potato"
  - `DOCUMENT_FOLDER_NAME`: "문서"
  - `TEMPLATE_FOLDER_NAME`: "양식"
- [ ] 웹 앱 배포 권한 설정 확인

## 📦 배포 방법

### 방법 1: 새 배포 (권장 - 버전 관리)
1. Apps Script 에디터에서 **"배포"** → **"새 배포"** 클릭
2. 유형: **"웹 앱"** 선택
3. 설명: `v1.16.1 - 공유 템플릿 메타데이터 개선` (버전 명시)
4. 실행 권한: **"나"** 또는 **"모든 사용자"**
5. 액세스 권한: **"모든 사용자"** 또는 **"조직 내 사용자"**
6. 배포 후 **새 URL 생성** (기존 URL과 다름)
7. 프론트엔드 환경변수 업데이트 필요

**장점:**
- ✅ 버전 관리 가능
- ✅ 문제 발생 시 이전 버전으로 롤백 가능
- ✅ 배포 이력 추적 가능

### 방법 2: 기존 배포 업데이트 (빠른 배포)
1. Apps Script 에디터에서 **"배포"** → **"배포 관리"** 클릭
2. 기존 배포 옆 **"연필 아이콘"** 클릭
3. **"버전"** 선택: **"새 버전"**
4. **"업데이트"** 클릭
5. 기존 URL 유지됨 (프론트엔드 변경 불필요)

**장점:**
- ✅ URL 변경 불필요
- ✅ 즉시 적용
- ⚠️ 롤백 어려움

## 🔍 배포 후 확인 사항

1. **API 응답 확인**
   ```javascript
   // 브라우저 콘솔에서 테스트
   fetch('YOUR_APP_SCRIPT_URL', {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify({ action: 'getSharedTemplates' })
   })
   .then(r => r.json())
   .then(data => console.log('템플릿 목록:', data));
   ```

2. **메타데이터 포함 확인**
   - 각 템플릿에 `description`, `tag`, `creatorEmail` 등이 포함되어 있는지 확인

3. **에러 로그 모니터링**
   - Apps Script 에디터 → "실행" → "실행 로그" 확인
   - 예상치 못한 에러가 있는지 확인

## 📝 버전 관리

현재 버전: `1.16.0` (Main.gs 기준)

### 이번 배포 변경사항
- ✅ `getSharedTemplates()` 함수 개선
- ✅ properties 배열에서 메타데이터 추출 로직 수정
- ✅ 메타데이터 응답에 포함 확인
- ✅ API 재시도 로직 개선

### 권장 버전
- **새 배포**: `1.16.1` 또는 `1.17.0`
- **기존 배포 업데이트**: 버전 자동 증가

## ⚠️ 주의사항

1. **프로덕션 배포 전 테스트 환경에서 충분히 테스트**
2. **배포 후 즉시 모니터링** (특히 API 사용량 제한)
3. **롤백 계획 준비** (새 배포 방식 사용 시)
4. **프론트엔드와의 호환성 확인** (응답 구조 변경 시)

## 🆘 문제 발생 시

1. **에러 로그 확인**: Apps Script 에디터 → 실행 → 실행 로그
2. **이전 버전으로 롤백**: 배포 관리에서 이전 버전 선택
3. **디버깅 모드 활성화**: 필요시 디버깅 로그 추가

